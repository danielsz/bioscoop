<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-10-07 Tue 02:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bioscoop</title>
<meta name="author" content="Daniel Szmulewicz" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="stylesheet" href="css/et-book.css" type="text/css" media="screen" />
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="css/post.css" type="text/css" media="screen" />
<script type="text/javascript" src="js/navigation.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Bioscoop
<br />
<span class="subtitle">Creative coding with video</span>
</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgfab16a2">Motivation</a></li>
<li><a href="#orgf34c699">AST convergence</a></li>
<li><a href="#org122854d">Internals</a></li>
<li><a href="#orgdb665f9">The filtergraph</a></li>
<li><a href="#orgd394d18">The Language</a></li>
<li><a href="#org10ba488">Inspiration</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgfab16a2" class="outline-2">
<h2 id="orgfab16a2">Motivation</h2>
<div class="outline-text-2" id="text-orgfab16a2">
<p>
Historically, video editing has progressed from destructive
techniques, ie. cutting the negative, to non-destructive ones,
ie. non-linear editing. The latter has become possible due to film
being no longer analog but digital. In both cases, however, the
creative process is manual, or mouse-based. A different approach,
often overlooked, is programmatic: the editor spells out the edits he
wants to apply, and those are being carried out by an underlying
system.  FFmpeg is such a system; capable of carrying pretty much any
editing instruction you can think of.
</p>

<p>
FFmpeg is embedded in virtually every major platform and application
that handles media, yet its use in the creative coding community to
make video art is limited. Most video creators prefer to stay away
from the notoriously complex and error-prone string-based
syntax. Indeed, its usability is hindered by the information density
of its textual interface.
</p>

<p>
Bioscoop unleashes FFmpeg from its shackles and puts programmability
in the center of the creative process.
</p>
</div>
</div>
<div id="outline-container-orgf34c699" class="outline-2">
<h2 id="orgf34c699">AST convergence</h2>
<div class="outline-text-2" id="text-orgf34c699">
<p>
The standout feature in terms of implementation and design is that
Bioscoop does both standalone compilation and macro expansion without
code duplication. Early in the project, as soon as the grammar for the
language was defined, I realized that I didn't want to choose between
an internal or external DSL. I wanted both.
</p>

<p>
Typically, external DSLs use a parser that produces a custom abstract
syntax tree (AST), which then gets processed by a dedicated
transformation pipeline specific to that parser. Meanwhile, internal
DSLs use macros that directly generate target code without going
through an intermediate AST structure. This creates two completely
separate code generation paths - one for parsed text and another for
macro-expanded forms - leading to duplicated transformation logic,
potential behavioral inconsistencies between the two modalities, and
significant maintenance overhead as changes must be applied to both
transformation systems independently.
</p>

<p>
Traditional DSL Implementation*:
</p>
<ul class="org-ul">
<li>External DSL: Parser → AST → Transformer</li>
<li>Internal DSL: Macro → Direct Code Generation</li>
<li><b>Problem</b>: Transformation logic is duplicated.</li>
</ul>

<p>
In Bioscoop, a single <code>transform-ast</code> multimethod handles both external
and internal DSLs. The external parser processes text strings into a
parse tree, which is then transformed into AST nodes. The internal
macro converts Clojure forms into the exact same parse tree structure,
enabling both input modalities to share the single transformation
logic that converts the parse tree into the final AST structure. This
convergence at the parse tree level ensures behavioral consistency
while eliminating redundant transformation implementations.
</p>

<p>
<b>AST Convergence Approach</b>:
</p>
<ul class="org-ul">
<li>External DSL: Parser → AST → Transformer</li>
<li>Internal DSL: Macro → AST → Transformer</li>
<li><b>Solution</b>: Single transformation logic.</li>
</ul>

<p>
<b>AST Convergence</b> occurs when both the external DSL parser and the
internal DSL macro system produce <b>identical abstract syntax trees</b>,
enabling a single transformation pipeline to handle both input
modalities.
</p>

<p>
A camera-ready <i>LaTeX</i> <a href="file:///home/daniel/Clojure/bioscoop/paper/ast_convergence_paper.pdf">paper</a> (for conference submissions) is available
in the repository. It elaborates further on the concept of AST
convergence.
</p>
</div>
</div>
<div id="outline-container-org122854d" class="outline-2">
<h2 id="org122854d">Internals</h2>
<div class="outline-text-2" id="text-org122854d">
<p>
The project is structured around several key components:
</p>
</div>
<div id="outline-container-orgb5f2fcf" class="outline-4">
<h4 id="orgb5f2fcf"><b>DSL Parser (<code>src/bioscoop/dsl.clj</code>)</b></h4>
<div class="outline-text-4" id="text-orgb5f2fcf">
<ul class="org-ul">
<li>Uses <b>Instaparse</b> to parse a Lisp-like syntax defined in <code>resources/lisp-grammar.bnf</code></li>
<li>Grammar allows for expressions like <code>(scale 1920 1080)</code> and <code>(let [width 1920] (scale width 1080))</code></li>
<li>Supports typical Lisp constructs: functions, let bindings, symbols, keywords, strings, numbers, booleans</li>
<li>Transformation of the parse tree into internal representation</li>
</ul>
</div>
</div>
<div id="outline-container-org6534b6c" class="outline-4">
<h4 id="org6534b6c"><b>Core Data Structures</b></h4>
<div class="outline-text-4" id="text-org6534b6c">
<p>
Three main records represent FFmpeg concepts:
</p>
<ul class="org-ul">
<li><b>Filter</b>: A single filter operation (e.g., scale, overlay, crop)</li>
<li><b>FilterChain</b>: A sequence of filters connected in series (comma-separated in FFmpeg)</li>
<li><b>FilterGraph</b>: Multiple filter chains running in parallel (semicolon-separated in FFmpeg)</li>
</ul>
</div>
</div>
<div id="outline-container-org197da87" class="outline-4">
<h4 id="org197da87"><b>Domain Model (<code>src/bioscoop/domain/</code>)</b></h4>
<div class="outline-text-4" id="text-org197da87">
<ul class="org-ul">
<li>Uses Clojure Spec to define the structure of filters, filter chains, and filtergraphs</li>
<li>Provides validation for the core data structures</li>
</ul>
</div>
</div>
<div id="outline-container-orgc38b0c2" class="outline-4">
<h4 id="orgc38b0c2"><b>Rendering Engine (<code>src/bioscoop/render.clj</code>)</b></h4>
<div class="outline-text-4" id="text-orgc38b0c2">
<ul class="org-ul">
<li>Implements the <code>FFmpegRenderable</code> protocol to convert data structures to FFmpeg syntax</li>
<li>Handles input/output labels for complex filtergraphs</li>
<li>Ensures proper escaping and formatting</li>
</ul>
</div>
</div>
<div id="outline-container-orgc748ae0" class="outline-4">
<h4 id="orgc748ae0">Bidirectional Translation</h4>
<div class="outline-text-4" id="text-orgc748ae0">
<ul class="org-ul">
<li><i>src/bioscoop/render.clj</i>: Converts DSL → FFmpeg filtergraph strings</li>
<li><i>src/bioscoop/ffmpeg.clj</i>: Parses existing FFmpeg filtergraph strings → DSL structures</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgdb665f9" class="outline-2">
<h2 id="orgdb665f9">The filtergraph</h2>
<div class="outline-text-2" id="text-orgdb665f9">
<p>
In FFmpeg, atomic editing operations—such as scaling, cropping,
blending, and color correction—are implemented as filters. With over
500 filters available, FFmpeg provides extensive transformation
capabilities.
</p>

<p>
When multiple filters are applied sequentially to source material,
they form a filterchain, written as comma-separated
commands. Filterchains can be labeled at their input and output
points, allowing one chain's output to serve as another's input. These
interconnected filterchains create a directed acyclic graph (DAG)
structure, which FFmpeg calls a filtergraph.  Filtergraphs are passed
to FFmpeg using the <code>-filter_complex</code> parameter.
</p>

<p>
That string-based syntax maps closely with the underlying <code>libavfilter</code>
that parses it. What is happening is the following: the parser
(<code>libavfilter/graphparser.c</code>) tokenizes the string, identifying
individual filters, their parameters, and the connections between
them.
</p>

<p>
Each filter name in the string (like <code>scale</code>, <code>overlay</code>, <code>colorkey</code>) maps to
a registered filter implementation in <code>libavfilter</code>. FFmpeg looks up
these filters in its internal registry and instantiates them as
<code>AVFilterContext</code> objects. Key-value pairs within each filter
specification are parsed and passed to the filter's initialization
function, which validates and stores them in the filter's private
context structure.
</p>

<p>
The parser creates an AVFilterGraph object and connects the
instantiated filters according to the semicolons (filterchain
boundaries) and labels in the string. Each connection becomes an
AVFilterLink that defines data flow between filter pads.
</p>

<p>
FFmpeg validates the complete graph topology, checking that
input/output pad counts match, media types are compatible (audio
vs. video), and that there are no cycles.
</p>

<ul class="org-ul">
<li>Filter names → AVFilter structs registered in libavfilter</li>
<li>Parameters (key=value) → Filter-specific configuration passed to
AVFilter-&gt;init()</li>
<li>Filterchains (comma-separated) → Linked sequences of AVFilterContext nodes</li>
<li>Labels ([label]) → Named AVFilterLink references for graph routing</li>
<li>Semicolons → Graph branching points that create multiple parallel
paths</li>
</ul>

<p>
This one-way translation from string to internal structures is the
core problem: there's no inverse mapping. Once parsed, the
<code>AVFilterGraph</code> exists in memory, but there's no standardized way to
serialize it back or manipulate it programmatically before the string
parsing step. Developers must work in strings because <code>libavfilter</code>'s
graph construction API, while programmatically accessible, is complex
and poorly documented compared to the string syntax.
</p>

<p>
The string format is essentially a convenience layer over
<code>libavfilter</code>'s C API—and it's become the <i>only</i> practical interface,
despite its limitations.
</p>

<p>
This creates several challenges:
</p>

<p>
<b>No programmatic structure</b>: Unlike many modern tools that use JSON,
YAML, or object-based APIs, filtergraphs cannot be easily constructed,
validated, or manipulated programmatically. There's no schema to
reference, no type checking, and no ability to introspect the graph
structure before execution.
</p>

<p>
<b>String concatenation dependency</b>: Building dynamic filtergraphs
requires manual string concatenation, making the code fragile and
error-prone. A single misplaced comma, semicolon, or bracket can break
the entire pipeline, with errors only surfacing at runtime.
</p>

<p>
<b>Limited tooling support</b>: Because filtergraphs lack a formal
representation, IDEs cannot provide syntax highlighting,
auto-completion, or validation. Developers must memorize the syntax or
constantly reference documentation.
</p>

<p>
<b>Debugging difficulty</b>: When a filtergraph fails, error messages
reference the string position rather than logical components, making
it hard to identify which filter or connection caused the problem.
</p>

<p>
This string-only representation means filtergraphs are essentially
"write-only" code—difficult to read, maintain, and programmatically
generate at scale.
</p>
</div>
</div>
<div id="outline-container-orgd394d18" class="outline-2">
<h2 id="orgd394d18">The Language</h2>
<div class="outline-text-2" id="text-orgd394d18">
<p>
The DSL accepts a Lisp-like syntax with the following core constructs:
</p>
</div>
<div id="outline-container-orgcda67ad" class="outline-4">
<h4 id="orgcda67ad">Basic Syntax Elements</h4>
<div class="outline-text-4" id="text-orgcda67ad">
<p>
<b>Program Structure:</b>
</p>
<ul class="org-ul">
<li>A program consists of zero or more expressions</li>
<li>Multiple expressions are automatically composed into filter graphs</li>
</ul>

<p>
<b>Atoms:</b>
</p>
<ul class="org-ul">
<li><b>Numbers</b>: <code>42</code>, <code>-3.14</code>, <code>1920</code></li>
<li><b>Strings</b>: <code>"hello world"</code>, <code>"in"</code>, <code>"1920x1080"</code></li>
<li><b>Symbols</b>: <code>scale</code>, <code>my-filter</code>, <code>input-vid</code></li>
<li><b>Keywords</b>: <code>:input</code>, <code>:output</code>, <code>:color</code></li>
<li><b>Booleans</b>: <code>true</code>, <code>false</code></li>
</ul>
</div>
</div>
<div id="outline-container-org60ee383" class="outline-4">
<h4 id="org60ee383">Core Language Constructs</h4>
<div class="outline-text-4" id="text-org60ee383">
</div>
<ul class="org-ul">
<li><a id="org0050f55"></a>1. <b>Function Calls (Lists)</b><br />
<div class="outline-text-5" id="text-org0050f55">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>scale 1920 1080<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>overlay <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"main"</span><span style="color: #7388d6;">}</span> <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"overlay"</span><span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>drawtext <span style="color: #8b2252;">"text='Hello World'"</span> <span style="color: #8b2252;">"x=100"</span> <span style="color: #8b2252;">"y=50"</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgea14400"></a>2. <b>Variable Binding (let)</b><br />
<div class="outline-text-5" id="text-orgea14400">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #7388d6;">[</span>width 1920
      height 1080<span style="color: #7388d6;">]</span>
  <span style="color: #7388d6;">(</span>scale width height<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org940b1bf"></a>3. <b>Filter Chains</b><br />
<div class="outline-text-5" id="text-org940b1bf">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>chain
  <span style="color: #7388d6;">(</span>scale 1920 1080<span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>crop <span style="color: #8b2252;">"iw/2"</span> <span style="color: #8b2252;">"ih"</span> <span style="color: #8b2252;">"0"</span> <span style="color: #8b2252;">"0"</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>hflip<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgcb38091"></a>4. <b>Filter Graphs (Parallel Processing)</b><br />
<div class="outline-text-5" id="text-orgcb38091">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>graph
  <span style="color: #7388d6;">(</span>chain <span style="color: #909183;">(</span>scale 1920 1080<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>crop <span style="color: #8b2252;">"220"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span>
  <span style="color: #7388d6;">(</span>chain <span style="color: #909183;">(</span>hflip<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>vflip<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org8c76164"></a>5. <b>Graph Definitions (Reusable Components)</b><br />
<div class="outline-text-5" id="text-org8c76164">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>defgraph my-scale <span style="color: #7388d6;">(</span>scale 1920 1080<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>defgraph mirror-pipeline 
  <span style="color: #7388d6;">(</span>chain 
    <span style="color: #909183;">(</span>crop <span style="color: #8b2252;">"iw/2"</span> <span style="color: #8b2252;">"ih"</span> <span style="color: #8b2252;">"0"</span> <span style="color: #8b2252;">"0"</span><span style="color: #909183;">)</span> 
    <span style="color: #909183;">(</span>split <span style="color: #709870;">{</span><span style="color: #008b8b;">:output</span> <span style="color: #8b2252;">"left"</span><span style="color: #709870;">}</span> <span style="color: #709870;">{</span><span style="color: #008b8b;">:output</span> <span style="color: #8b2252;">"tmp"</span><span style="color: #709870;">}</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>hflip <span style="color: #709870;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"tmp"</span><span style="color: #709870;">}</span> <span style="color: #709870;">{</span><span style="color: #008b8b;">:output</span> <span style="color: #8b2252;">"right"</span><span style="color: #709870;">}</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>hstack <span style="color: #709870;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"left"</span><span style="color: #709870;">}</span> <span style="color: #709870;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"right"</span><span style="color: #709870;">}</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="orgd0bfcc5"></a>6. <b>Label Management</b><br />
<div class="outline-text-5" id="text-orgd0bfcc5">
<p>
<b>Explicit Labels:</b>
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>input-labels <span style="color: #8b2252;">"in"</span> <span style="color: #8b2252;">"video0"</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>output-labels <span style="color: #8b2252;">"out"</span> <span style="color: #8b2252;">"processed"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
<b>Inline Labels (Map Syntax):</b>
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>scale 1920 1080 <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:input</span> <span style="color: #8b2252;">"in"</span><span style="color: #7388d6;">}</span> <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:output</span> <span style="color: #8b2252;">"scaled"</span><span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org0d34e6f"></a>7. <b>Padded Graphs (Complex Labeling)</b><br />
<div class="outline-text-5" id="text-org0d34e6f">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">[</span><span style="color: #7388d6;">[</span>in<span style="color: #7388d6;">][</span>offset<span style="color: #7388d6;">]</span> <span style="color: #7388d6;">(</span>chain <span style="color: #909183;">(</span>scale 1920 1080<span style="color: #909183;">)</span> <span style="color: #909183;">(</span>crop <span style="color: #8b2252;">"220"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">)</span> <span style="color: #7388d6;">[</span>out<span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
<span style="color: #707183;">[</span><span style="color: #7388d6;">[</span>v:0<span style="color: #7388d6;">][</span>v:1<span style="color: #7388d6;">]</span> my-complex-filter <span style="color: #7388d6;">[</span>processed<span style="color: #7388d6;">]</span><span style="color: #707183;">]</span>
</pre>
</div>
</div>
</li>
<li><a id="org8e9fffe"></a>8. <b>Composition</b><br />
<div class="outline-text-5" id="text-org8e9fffe">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>compose graph1 graph2 graph3<span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-orgd001cc2" class="outline-4">
<h4 id="orgd001cc2">Built-in Functions</h4>
<div class="outline-text-4" id="text-orgd001cc2">
<p>
The DSL provides access to numerous FFmpeg filters including:
</p>

<ul class="org-ul">
<li><b>Scaling &amp; Cropping</b>: <code>scale</code>, <code>crop</code>, <code>pad</code></li>
<li><b>Color &amp; Effects</b>: <code>color</code>, <code>hue</code>, <code>negate</code>, <code>curves</code>, <code>threshold</code></li>
<li><b>Layout &amp; Composition</b>: <code>hstack</code>, <code>vstack</code>, <code>xstack</code>, <code>overlay</code>, <code>blend</code></li>
<li><b>Transforms</b>: <code>hflip</code>, <code>vflip</code>, <code>zoompan</code></li>
<li><b>Text &amp; Drawing</b>: <code>drawtext</code>, <code>drawgrid</code></li>
<li><b>Sources</b>: <code>testsrc</code>, <code>rgbtestsrc</code>, <code>smptebars</code></li>
<li><b>Time-based</b>: <code>fade</code>, <code>loop</code>, <code>trim</code>, <code>setpts</code></li>
<li><b>Advanced</b>: <code>split</code>, <code>concat</code>, <code>lut</code>, <code>lagfun</code>, <code>cellauto</code></li>
</ul>
</div>
</div>
<div id="outline-container-org8394c03" class="outline-4">
<h4 id="org8394c03">Parameter Passing</h4>
<div class="outline-text-4" id="text-org8394c03">
<p>
<b>Positional Parameters:</b>
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>scale 1920 1080<span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>crop <span style="color: #8b2252;">"iw/2"</span> <span style="color: #8b2252;">"ih"</span> <span style="color: #8b2252;">"0"</span> <span style="color: #8b2252;">"0"</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
<b>Named Parameters (Maps):</b>
</p>
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span>color <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:color</span> <span style="color: #8b2252;">"blue"</span> <span style="color: #008b8b;">:size</span> <span style="color: #8b2252;">"1920x1080"</span> <span style="color: #008b8b;">:rate</span> 24 <span style="color: #008b8b;">:duration</span> <span style="color: #8b2252;">"10"</span><span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>
<span style="color: #707183;">(</span>drawtext <span style="color: #7388d6;">{</span><span style="color: #008b8b;">:text</span> <span style="color: #8b2252;">"Hello World"</span> <span style="color: #008b8b;">:x</span> 100 <span style="color: #008b8b;">:y</span> 50 <span style="color: #008b8b;">:fontsize</span> 24<span style="color: #7388d6;">}</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org2629339" class="outline-4">
<h4 id="org2629339">Advanced Features</h4>
<div class="outline-text-4" id="text-org2629339">
</div>
<ul class="org-ul">
<li><a id="org3e96d25"></a>Mathematical Expressions<br />
<div class="outline-text-5" id="text-org3e96d25">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #7388d6;">[</span>width <span style="color: #909183;">(</span>mod 10 6<span style="color: #909183;">)</span>
      size <span style="color: #909183;">(</span>max 1920 1080<span style="color: #909183;">)</span>
      next <span style="color: #909183;">(</span>inc 1919<span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
  <span style="color: #7388d6;">(</span>scale width size<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>
</div>
</li>
<li><a id="org3730d40"></a>Complex Pipeline Example<br />
<div class="outline-text-5" id="text-org3730d40">
<div class="org-src-container">
<pre class="src src-clojure"><span style="color: #707183;">(</span><span style="color: #a020f0;">let</span> <span style="color: #7388d6;">[</span>out-left-tmp <span style="color: #909183;">(</span>output-labels <span style="color: #8b2252;">"left"</span> <span style="color: #8b2252;">"tmp"</span><span style="color: #909183;">)</span>
      in-tmp <span style="color: #909183;">(</span>input-labels <span style="color: #8b2252;">"tmp"</span><span style="color: #909183;">)</span> 
      out-right <span style="color: #909183;">(</span>output-labels <span style="color: #8b2252;">"right"</span><span style="color: #909183;">)</span>
      in-left-right <span style="color: #909183;">(</span>input-labels <span style="color: #8b2252;">"left"</span> <span style="color: #8b2252;">"right"</span><span style="color: #909183;">)</span><span style="color: #7388d6;">]</span>
  <span style="color: #7388d6;">(</span>graph
    <span style="color: #909183;">(</span>chain
      <span style="color: #709870;">(</span>crop <span style="color: #8b2252;">"iw/2"</span> <span style="color: #8b2252;">"ih"</span> <span style="color: #8b2252;">"0"</span> <span style="color: #8b2252;">"0"</span><span style="color: #709870;">)</span>
      <span style="color: #709870;">(</span>split out-left-tmp<span style="color: #709870;">)</span><span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>hflip in-tmp out-right<span style="color: #909183;">)</span>
    <span style="color: #909183;">(</span>hstack in-left-right<span style="color: #909183;">)</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span>
</pre>
</div>

<p>
This compiles to the FFmpeg filter graph:
</p>
<div class="org-src-container">
<pre class="src src-nil">crop=out_w=iw/2:w=ih:out_h=0:h=0,split[left][tmp];[tmp]hflip[right];[left][right]hstack
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-org10da70f" class="outline-4">
<h4 id="org10da70f">Language Design Principles</h4>
<div class="outline-text-4" id="text-org10da70f">
<ol class="org-ol">
<li><b>Composability</b>: Every construct can be composed with others</li>
<li><b>Immutability</b>: Variables are bound once and cannot be reassigned</li>
<li><b>Explicit Labeling</b>: Stream labels are first-class citizens</li>
<li><b>Structural Equivalence</b>: The DSL produces the same internal structures as parsing FFmpeg commands directly</li>
<li><b>Error Handling</b>: Comprehensive error reporting for invalid parameters and syntax</li>
</ol>
</div>
</div>
<div id="outline-container-orge378def" class="outline-4">
<h4 id="orge378def">Grammar Rules (BNF Summary)</h4>
<div class="outline-text-4" id="text-orge378def">
<p>
The language follows these production rules:
</p>

<div class="org-src-container">
<pre class="src src-nil">program = expression*
expression = atom | list | let-binding | map | compose | graph-definition | padded-graph
let-binding = '(' 'let' binding-vector expression+ ')'
graph-definition = '(' 'defgraph' symbol expression* ')'
padded-graph = '[' label+ expression* label+ ']'
compose = '(' 'compose' expression+ ')'
list = '(' expression* ')'
map = '{' mapentry* '}'
atom = number | boolean | symbol | string | keyword
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org10ba488" class="outline-2">
<h2 id="org10ba488">Inspiration</h2>
<div class="outline-text-2" id="text-org10ba488">
<blockquote>
<p>
The acts of the mind, wherein it exerts its power over simple ideas, are chiefly these three:
</p>

<ol class="org-ol">
<li>Combining several simple ideas into one compound one, and thus all
complex ideas are made.</li>

<li>The second is bringing two ideas, whether simple or complex,
together, and setting them by one another so as to take a view of
them at once, without uniting them into one, by which it gets all
its ideas of relations.</li>

<li>The third is separating them from all other ideas that accompany
them in their real existence: this is called abstraction, and thus
all its general ideas are made.</li>
</ol>

<p>
—John Locke, An Essay Concerning Human Understanding (1690)
</p>
</blockquote>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Daniel Szmulewicz</p>
<p class="date">Created: 2025-10-07 Tue 02:46</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
